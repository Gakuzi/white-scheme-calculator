<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>WhitePay — мастер перехода на белую схему</title>
<meta name="description" content="Калькулятор/мастер для убеждения в переходе на прозрачную белую зарплатную схему. Стиль Apple: минимализм, glassmorphism, анимация весов." />

<!-- Fonts & Chart.js -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
  :root{
    --bg:#0f1724;
    --glass: rgba(255,255,255,0.06);
    --glass-2: rgba(255,255,255,0.04);
    --muted: rgba(255,255,255,0.65);
    --accent:#0ea5e9; /* cyan-ish */
    --accent-2:#7c3aed; /* purple */
    --glass-border: rgba(255,255,255,0.08);
    --ok:#7ee787;
    --warn:#ff7b72;
    --glass-shadow: 0 8px 24px rgba(2,6,23,0.6);
    --radius:14px;
    font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    color-scheme: dark;
  }
  html,body{height:100%;margin:0;background:
    radial-gradient(1200px 600px at 10% 10%, rgba(124,58,237,0.12), transparent 8%),
    radial-gradient(900px 400px at 90% 80%, rgba(14,165,233,0.08), transparent 6%),
    var(--bg);
    -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
  }
  .wrap{max-width:1200px;margin:28px auto;padding:20px;box-sizing:border-box}
  header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
  .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:white;font-weight:700;box-shadow:0 6px 18px rgba(124,58,237,0.18);font-size:18px}
  h1{margin:0;color:#fff;font-weight:600;font-size:20px}
  .sub{color:var(--muted);font-size:13px;margin-top:4px}

  /* layout */
  .main-grid{display:grid;grid-template-columns:420px 1fr;gap:18px}
  @media (max-width:980px){.main-grid{grid-template-columns:1fr}}

  /* glass card */
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:var(--radius);padding:18px;border:1px solid var(--glass-border);
    box-shadow: var(--glass-shadow);
    backdrop-filter: blur(8px) saturate(120%);
  }
  .card h2{color:#fff;margin:0 0 10px;font-weight:600}

  /* wizard steps */
  .stepper{display:flex;gap:8px;margin-bottom:14px;align-items:center}
  .step{
    padding:8px 12px;border-radius:999px;font-size:13px;background:transparent;border:1px solid transparent;color:var(--muted)
  }
  .step.active{
    background: linear-gradient(90deg, rgba(14,165,233,0.12), rgba(124,58,237,0.08));
    color:#fff;border:1px solid rgba(255,255,255,0.06);
    box-shadow: 0 6px 18px rgba(2,6,23,0.55);
  }

  label{display:block;color:var(--muted);font-size:13px;margin-bottom:6px}
  input[type=number], select {
    width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    color:#fff;font-size:15px;
    outline:none;
    transition:box-shadow .18s,transform .12s;
    box-shadow: inset 0 -1px 0 rgba(255,255,255,0.01);
  }
  input[type=number]:focus{box-shadow:0 6px 18px rgba(14,165,233,0.12);transform:translateY(-1px)}
  .row{display:flex;gap:12px}
  .cols-2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .cols-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
  .muted{color:var(--muted);font-size:13px}

  .hint{display:flex;gap:8px;align-items:center;font-size:13px;color:var(--muted)}
  .i{width:26px;height:26px;border-radius:8px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;color:var(--muted);font-weight:600}

  /* Beautiful buttons */
  .btn{
    display:inline-flex;align-items:center;gap:10px;padding:10px 14px;border-radius:12px;border:none;font-weight:600;cursor:pointer;
    background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    color:#fff;border:1px solid rgba(255,255,255,0.06);
    box-shadow: 0 6px 20px rgba(2,6,23,0.5);
    transition:transform .12s,box-shadow .12s;
  }
  .btn.primary{
    background: linear-gradient(90deg,var(--accent),var(--accent-2));
    box-shadow: 0 12px 30px rgba(124,58,237,0.18);
  }
  .btn:active{transform:translateY(1px)}

  /* right column results */
  .result-top{display:flex;justify-content:space-between;align-items:center;gap:12px}
  .big-num{font-size:28px;color:#fff;font-weight:700}
  .kpi-small{color:var(--muted);font-size:13px}

  .table{margin-top:12px;border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,0.04)}
  .table table{width:100%;border-collapse:collapse}
  .table th, .table td{padding:12px;text-align:right;border-bottom:1px solid rgba(255,255,255,0.02);font-size:14px;color:#fff}
  .table th:first-child,.table td:first-child{text-align:left;color:var(--muted)}
  .good{color:var(--ok);font-weight:700}
  .bad{color:var(--warn);font-weight:700}

  /* scales */
  .scales-wrap{display:flex;align-items:center;justify-content:center;padding:18px}
  .scales{
    width:320px;height:260px;position:relative;
  }
  /* scale labels overlay */
  .scale-label{position:absolute;left:50%;transform:translateX(-50%);top:18px;color:#fff;font-weight:700;font-size:18px;pointer-events:none}
  .scale-sub{position:absolute;left:50%;transform:translateX(-50%);top:46px;color:var(--muted);font-size:13px}

  /* weights amounts */
  .scale-amount-left, .scale-amount-right{
    position:absolute;bottom:26px;color:#fff;font-weight:700;font-size:16px;
    text-align:center;width:120px;
  }
  .scale-amount-left{left:16px}
  .scale-amount-right{right:16px}

  /* arguments card */
  .arg-title{font-weight:700;color:#fff;margin-bottom:8px}
  .arg-list{display:grid;gap:8px}
  .arg{background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
  .arg h4{margin:0 0 6px;color:#fff;font-size:14px}
  .arg p{margin:0;color:var(--muted);font-size:13px}

  footer{margin-top:20px;color:var(--muted);font-size:13px;text-align:center}
  .small{font-size:12px;color:var(--muted)}
  .tooltip{
    position:relative;display:inline-block
  }
  .tooltip .tip{
    position:absolute;left:50%;transform:translateX(-50%);bottom:120%;white-space:nowrap;background:rgba(18,18,20,0.9);color:#fff;padding:8px 10px;border-radius:8px;font-size:13px;border:1px solid rgba(255,255,255,0.06);display:none;
  }
  .tooltip:hover .tip{display:block}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo">W</div>
    <div>
      <h1>WhitePay — мастер перехода на белую схему</h1>
      <div class="sub">Пошаговый мастер — расчёты, графики, анимированные весы и готовые доводы для переговоров</div>
    </div>
  </header>

  <div class="main-grid">
    <!-- LEFT: Wizard -->
    <div>
      <div class="card">
        <div class="stepper" id="stepper">
          <div class="step active">1. Основные</div>
          <div class="step">2. Накладные</div>
          <div class="step">3. Риски</div>
          <div class="step">4. Обзор</div>
        </div>

        <!-- STEP 1 -->
        <div class="step-panel" data-step="1">
          <h2>Основные параметры</h2>
          <div class="cols-2" style="margin-top:12px">
            <div>
              <label>Зарплата на руки (W), ₽ <span class="tooltip"><span class="i">i</span><span class="tip">Сколько сотрудник получает «чистыми» — вводите реальную цифру</span></span></label>
              <input id="W" type="number" value="100000" step="100">
            </div>
            <div>
              <label>МРОТ, ₽</label><input id="mrot" type="number" value="19242">
            </div>
            <div>
              <label>Районный коэффициент (РК)</label><input id="rk" type="number" step="0.01" value="1.2">
            </div>
            <div>
              <label>Северная надбавка (доля)</label><input id="north" type="number" step="0.01" value="0.5">
            </div>
            <div>
              <label>НДФЛ (p)</label><input id="p" type="number" step="0.01" value="0.13">
            </div>
            <div>
              <label>Взносы (c)</label><input id="c" type="number" step="0.01" value="0.30">
            </div>
            <div>
              <label>УСН (t)</label><input id="t" type="number" step="0.01" value="0.15">
            </div>
            <div>
              <label>Комиссия обнала (k)</label><input id="k" type="number" step="0.01" value="0.13">
            </div>
          </div>
        </div>

        <!-- STEP 2 -->
        <div class="step-panel" data-step="2" style="display:none">
          <h2>Накладные и сопровождение</h2>
          <div class="cols-3" style="margin-top:10px">
            <div>
              <label>Бухгалтер (белая)</label><input id="accWhite" type="number" value="3000">
            </div>
            <div>
              <label>Бухгалтер (серая)</label><input id="accGrey" type="number" value="4000">
            </div>
            <div>
              <label>Бухгалтер (чёрная)</label><input id="accBlack" type="number" value="4500">
            </div>
            <div>
              <label>Юрист (белая)</label><input id="lawWhite" type="number" value="3500">
            </div>
            <div>
              <label>Юрист (серая)</label><input id="lawGrey" type="number" value="5000">
            </div>
            <div>
              <label>Юрист (чёрная)</label><input id="lawBlack" type="number" value="6500">
            </div>
            <div>
              <label>Обслуживание «чёрной» бух.</label><input id="svcBlack" type="number" value="0">
            </div>
            <div>
              <label>Серверы / IT</label><input id="it" type="number" value="0">
            </div>
            <div>
              <label>Экономия на больничных (S_med)</label><input id="Smed" type="number" value="1700">
            </div>
          </div>
        </div>

        <!-- STEP 3 -->
        <div class="step-panel" data-step="3" style="display:none">
          <h2>Чек-лист рисков</h2>
          <p class="muted">Оцените по 0 / 0.5 / 1 — мастер подскажет значение вероятности</p>
          <div style="margin-top:12px">
            <div class="cols-2" id="risksArea"></div>
          </div>
          <div style="margin-top:12px" class="row">
            <div style="flex:1">
              <label>Средний риск (R)</label><input id="R" readonly>
            </div>
            <div style="flex:1">
              <label>P₃ (3 года)</label><input id="P3" readonly>
            </div>
            <div style="flex:1">
              <label>P (в мес.)</label><input id="P" readonly>
            </div>
          </div>
        </div>

        <!-- STEP 4 -->
        <div class="step-panel" data-step="4" style="display:none">
          <h2>Обзор и проверка</h2>
          <p class="muted">Мастер проверит данные и предложит улучшения. Нажмите «Рассчитать».</p>
          <div style="margin-top:12px" class="row">
            <button class="btn primary" id="calcBtn">Рассчитать</button>
            <button class="btn" id="resetBtn">Сбросить</button>
            <button class="btn" id="exportBtn">Скачать PDF</button>
          </div>
          <div style="margin-top:12px" id="adviceArea"></div>
        </div>

        <div style="margin-top:12px;display:flex;gap:8px;justify-content:space-between;align-items:center">
          <div class="small muted">Мастер упрощает подготовку к разговору — используйте готовые тезисы в разделе «Аргументы».</div>
          <div>
            <button class="btn" id="prevBtn" style="display:none">← Назад</button>
            <button class="btn primary" id="nextBtn">Далее →</button>
          </div>
        </div>
      </div>

      <!-- Arguments / Persuasion snippets -->
      <div style="margin-top:14px" class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="arg-title">Готовые фразы для переговоров</div>
            <div class="muted small">Скопируйте и вставьте в почту или подготовьте презентацию.</div>
          </div>
          <div class="small muted">Этапы: финансовый, HR, имидж</div>
        </div>
        <div style="margin-top:10px" class="arg-list">
          <div class="arg">
            <h4>Фраза №1 — для руководителя</h4>
            <p>Переход на белую схему укрепит нашу финансовую устойчивость: риск штрафов и доначислений будет минимизирован, а банки и инвесторы будут оценивать компанию выше.</p>
          </div>
          <div class="arg">
            <h4>Фраза №2 — для HR / команда</h4>
            <p>Белая зарплата — это инвестиция в удержание сотрудников: меньше текучести, выше вовлечённость и проще привлекать сильные кадры.</p>
          </div>
          <div class="arg">
            <h4>Фраза №3 — для партнёров</h4>
            <p>Прозрачный бизнес повышает доверие контрагентов, открывает доступ к крупным тендерам и снижает риски цепных санкций.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT: Results + Scales -->
    <div>
      <div class="card">
        <div class="result-top">
          <div>
            <div class="big-num" id="headline">Открывайте расчёт — нажмите «Далее» →</div>
            <div class="kpi-small">Краткий итог: выгода / риск отображены на весах</div>
          </div>
          <div style="text-align:right">
            <div class="muted small">Сохранение: локально</div>
            <div style="height:6px"></div>
            <div class="small muted">GitHub Pages — готово</div>
          </div>
        </div>

        <div class="table" style="margin-top:12px">
          <table>
            <thead>
              <tr><th>Схема</th><th>Месяц, ₽</th><th>Год, ₽</th><th>Экономия vs. белая</th></tr>
            </thead>
            <tbody>
              <tr><td>Белая</td><td id="whiteM">—</td><td id="whiteY">—</td><td>—</td></tr>
              <tr><td>Серая</td><td id="greyM">—</td><td id="greyY">—</td><td id="greySave">—</td></tr>
              <tr><td>Чёрная</td><td id="blackM">—</td><td id="blackY">—</td><td id="blackSave">—</td></tr>
            </tbody>
          </table>
        </div>

        <div style="margin-top:12px" class="scales-wrap">
          <!-- Scales (SVG) -->
          <div class="scales" id="scales">
            <div class="scale-label">Взвешивание: выгода vs. риск</div>
            <div class="scale-sub">Анимированные весы показывают, что важнее сегодня</div>

            <svg viewBox="0 0 400 320" width="100%" height="100%" preserveAspectRatio="xMidYMid meet">
              <!-- stand -->
              <g id="scale-stand" transform="translate(200,40)">
                <rect x="-4" y="0" width="8" height="200" rx="4" fill="rgba(255,255,255,0.06)"></rect>
                <circle cx="0" cy="-6" r="10" fill="rgba(255,255,255,0.06)"></circle>

                <!-- arm pivot -->
                <g id="arm" transform="rotate(0)">
                  <rect x="-120" y="-6" width="240" height="12" rx="6" fill="linearGradient"></rect>
                  <!-- left rope -->
                  <line id="ropeL" x1="-80" y1="6" x2="-120" y2="100" stroke="rgba(255,255,255,0.08)" stroke-width="2"></line>
                  <!-- right rope -->
                  <line id="ropeR" x1="80" y1="6" x2="120" y2="100" stroke="rgba(255,255,255,0.08)" stroke-width="2"></line>

                  <!-- left pan -->
                  <g id="panL" transform="translate(-120,100)">
                    <ellipse cx="0" cy="18" rx="48" ry="16" fill="rgba(14,165,233,0.08)"></ellipse>
                    <rect x="-48" y="18" width="96" height="16" rx="8" fill="rgba(255,255,255,0.02)"></rect>
                  </g>

                  <!-- right pan -->
                  <g id="panR" transform="translate(120,100)">
                    <ellipse cx="0" cy="18" rx="48" ry="16" fill="rgba(124,58,237,0.08)"></ellipse>
                    <rect x="-48" y="18" width="96" height="16" rx="8" fill="rgba(255,255,255,0.02)"></rect>
                  </g>

                </g>
              </g>
            </svg>

            <div class="scale-amount-left" id="leftAmount">Выгода: —</div>
            <div class="scale-amount-right" id="rightAmount">Риск: —</div>
          </div>
        </div>

        <div style="margin-top:12px">
          <canvas id="barChart" height="120"></canvas>
        </div>

      </div>

      <div style="margin-top:14px" class="card">
        <div class="arg-title">Аргументы в пользу «белой» схемы — структурированные</div>
        <div style="margin-top:10px" class="arg-list">
          <div class="arg">
            <h4>Финансовые</h4>
            <p>Белая схема минимизирует долгосрочные расходы: реальные штрафы и проценты при доначислениях часто превысят краткосрочную выгоду от серых схем.</p>
          </div>
          <div class="arg">
            <h4>HR и мораль</h4>
            <p>Стабильная «белая» выплата повышает лояльность, позволяет сотрудникам планировать кредиты и эффективно участвовать в долгосрочных проектах.</p>
          </div>
          <div class="arg">
            <h4>Имидж и рост</h4>
            <p>Прозрачность упрощает выход на рынок инвестиций, крупные закупки и сотрудничество с крупными клиентами.</p>
          </div>
        </div>
      </div>

    </div>
  </div>

  <footer>
    <div>© WhitePay — прототип для Евгения Климова • Данные сохраняются локально в браузере</div>
  </footer>
</div>

<script>
/* --------------- Utilities --------------- */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const toNum = v => { const n = parseFloat(String(v).replace(',','.')); return Number.isFinite(n)? n:0; };
const fmtR = n => isFinite(n) ? n.toLocaleString('ru-RU', {maximumFractionDigits:0})+' ₽' : '—';

/* --------------- Wizard --------------- */
let step = 1;
const steps = $$('#stepper .step');
const panels = $$('.step-panel');
function showStep(n){
  step = n;
  steps.forEach((el,i)=> el.classList.toggle('active', i+1===n));
  panels.forEach(p=> p.style.display = (Number(p.dataset.step)===n)?'block':'none');
  $('#prevBtn').style.display = (n>1)?'inline-flex':'none';
  $('#nextBtn').textContent = (n<4)? 'Далее →' : 'Готово';
}
$('#nextBtn').addEventListener('click', ()=>{
  if(step<4) showStep(step+1);
  else { // if at last, trigger calculate
    calculate();
    showStep(4);
  }
});
$('#prevBtn').addEventListener('click', ()=> showStep(Math.max(1,step-1)));
showStep(1);

/* --------------- Build risks UI --------------- */
const riskNames = [
  "Доля «технических» контрагентов",
  "Средняя ЗП vs. регион",
  "Доля наличных расходов",
  "Отклонение налоговой нагрузки",
  "Смена юрадреса/директора",
  "Дробление бизнеса"
];
const risksArea = $('#risksArea');
riskNames.forEach((name,i)=>{
  const wr = document.createElement('div');
  wr.innerHTML = `<label>${name}</label>
    <select id="risk_${i}">
      <option value="0">0 — нет</option>
      <option value="0.5">0.5 — средний</option>
      <option value="1">1 — высокий</option>
    </select>`;
  risksArea.appendChild(wr);
});

/* --------------- Default fields - gather all fields we use --------------- */
const ids = ['W','mrot','rk','north','p','c','t','k','phi','Smed',
  'accWhite','accGrey','accBlack','lawWhite','lawGrey','lawBlack','svcBlack','it'];
// set some defaults if not present
ids.forEach(id=>{
  const el = $('#'+id);
  if(!el) return;
  el.addEventListener('input', ()=> { calculate(); saveState(); });
});

/* risks listeners */
for(let i=0;i<riskNames.length;i++){
  $('#risk_'+i).addEventListener('change', ()=> { calculate(); saveState(); });
}

/* storage */
const STORAGE_KEY = 'whitepay-proto-v1';
function saveState(){
  const state = {};
  ids.forEach(id=> { const el=$('#'+id); if(el) state[id]=el.value; });
  state.risks = riskNames.map((_,i)=> $('#risk_'+i).value);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}
function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return;
    const s = JSON.parse(raw);
    ids.forEach(id=>{ if(s[id]!==undefined && $('#'+id)) $('#'+id).value = s[id]; });
    if(Array.isArray(s.risks)) s.risks.forEach((v,i)=> { if($('#risk_'+i)) $('#risk_'+i).value = v; });
  }catch(e){}
}
loadState();

/* --------------- Calculation logic (same formulas as в Excel) --------------- */
function computeAll(){
  const x = {};
  ids.forEach(id=> x[id]= toNum($('#'+id).value));
  x.W = toNum($('#W').value);
  // risks
  x.risks = riskNames.map((_,i)=> toNum($('#risk_'+i).value));
  const R = x.risks.reduce((a,b)=>a+b,0)/x.risks.length || 0;
  const P3 = R * 0.3;
  const P = P3 / 36;

  // intermediates
  const M = x.rk * (1 + x.north);
  const G = x.W / (1 - x.p);
  const G_min = x.mrot * M;
  const W_min = G_min * (1 - x.p);
  const E = Math.max(x.W - W_min, 0);

  // costs
  const C_white = (1 - x.t) * (1 + x.c) * G + (x.accWhite + x.lawWhite) - x.Smed;
  const C_grey  = (1 - x.t) * (1 + x.c) * G_min + (1 + x.k) * E + (x.accGrey + x.lawGrey + x.svcBlack + x.it) + P * x.t * E * x.phi;
  const C_black = (1 + x.k) * x.W + (x.accBlack + x.lawBlack + x.svcBlack + x.it) + P * x.t * x.W * x.phi;

  return { x, R, P3, P, M, G, G_min, W_min, E, C_white, C_grey, C_black };
}

/* update UI */
let barChart;
function updateUI(res){
  $('#R').value = res.R.toFixed(2);
  $('#P3').value = res.P3.toFixed(3);
  $('#P').value = res.P.toFixed(4);

  $('#headline').textContent = 'Результаты готовы — смотрите весы и таблицу';
  $('#whiteM').textContent = fmtR(res.C_white);
  $('#whiteY').textContent = fmtR(res.C_white*12);
  $('#greyM').textContent = fmtR(res.C_grey);
  $('#greyY').textContent = fmtR(res.C_grey*12);
  $('#blackM').textContent = fmtR(res.C_black);
  $('#blackY').textContent = fmtR(res.C_black*12);

  const diffGrey = Math.round(res.C_white - res.C_grey);
  const diffBlack = Math.round(res.C_white - res.C_black);
  $('#greySave').textContent = (diffGrey>=0?'+':'−') + fmtR(Math.abs(diffGrey));
  $('#greySave').className = (diffGrey>=0)?'good':'bad';
  $('#blackSave').textContent = (diffBlack>=0?'+':'−') + fmtR(Math.abs(diffBlack));
  $('#blackSave').className = (diffBlack>=0)?'good':'bad';

  // update chart
  const data = [res.C_white, res.C_grey, res.C_black].map(v=> Math.round(v));
  if(barChart) barChart.destroy();
  const ctx = document.getElementById('barChart').getContext('2d');
  barChart = new Chart(ctx, {
    type:'bar',
    data:{ labels:['Белая','Серая','Чёрная'], datasets:[{ label:'Руб/мес', data, backgroundColor:['#60f','rgba(14,165,233,0.5)','rgba(124,58,237,0.5)'] }]},
    options:{plugins:{legend:{display:false}}, scales:{y:{ticks:{callback:v=>v.toLocaleString('ru-RU')+' ₽'}}}
  });

  // update scales animation
  animateScales(res);
}

/* --------------- Scales animation --------------- */
let animFrame = null;
function animateScales(res){
  // compute scalar tilt: left = benefit (higher => tilt left), right = risk (higher => tilt right)
  const benefit = Math.max(0, res.C_white - Math.min(res.C_grey, res.C_black)); // how much white is more expensive -> interpretation: user expects savings? we present benefit as "value of white scheme" (we want to show advantage)
  // But user wanted "весы: сумма выгоды и риска на другой чаше" -> We'll show actual numeric: left = potential long-term benefit (reputation+HR value) approximated by diff over 12 months + intangible multiplier; to keep it simple, let's show diffGrey positive as benefit.
  // We'll compute leftAmount = max(C_white - min(C_grey,C_black), 0) (annual) and rightAmount = riskCost (P * t * max(W,E) * phi * 12) as annualized risk
  const leftAnnual = Math.max(0, res.C_white - Math.min(res.C_grey, res.C_black)) * 12;
  const riskBase = Math.max(res.x.W, res.E || 0);
  const rightAnnual = res.P * res.x.t * riskBase * res.x.phi * 12;

  // normalize to angle (-12deg..+12deg): if left > right => tilt left (-angle)
  const maxAngle = 12;
  const a = (leftAnnual - rightAnnual) / Math.max(1, leftAnnual + rightAnnual); // -1..1
  const angle = Math.max(-1, Math.min(1, a)) * maxAngle;

  // update amounts text
  $('#leftAmount').textContent = 'Выгода: ' + (leftAnnual>0? leftAnnual.toLocaleString('ru-RU')+' ₽/год':'—');
  $('#rightAmount').textContent = 'Риск: ' + (rightAnnual>0? Math.round(rightAnnual).toLocaleString('ru-RU')+' ₽/год':'—');

  // animate rotation of #arm in svg
  cancelAnimationFrame(animFrame);
  const arm = document.querySelector('#arm');
  const from = parseFloat(arm.getAttribute('data-angle')||'0');
  const to = angle;
  const start = performance.now();
  const dur = 700;
  function stepAnim(now){
    const t = Math.min(1, (now-start)/dur);
    const eased = (1 - Math.cos(Math.PI * t)) / 2;
    const cur = from + (to - from) * eased;
    arm.setAttribute('transform', `rotate(${cur})`);
    arm.setAttribute('data-angle', String(cur));
    if(t<1) animFrame = requestAnimationFrame(stepAnim);
  }
  animFrame = requestAnimationFrame(stepAnim);
}

/* --------------- Advice generation --------------- */
function generateAdvice(res){
  const adv = [];
  if(res.C_white - res.C_grey > 0) adv.push({t:'Финансы', d:'Белая схема дороже по данным расчёта. Однако учтите риск-скорректированную стоимость: при P>0.05 серые схемы могут обойтись дороже.'});
  else adv.push({t:'Финансы', d:'Белая схема показывает экономию в расчёте — аргументуйте это цифрами.'});
  if(res.R > 0.4) adv.push({t:'Риск', d:'Средний риск высокий — рекомендовано переходить на белую схему для минимизации риска доначислений.'});
  if(res.x.Smed > 0) adv.push({t:'HR', d:`Экономия на больничных ≈ ${res.x.Smed} ₽/мес влияет на реальную стоимость белой схемы.`});
  return adv;
}

/* --------------- Button listeners --------------- */
$('#calcBtn').addEventListener('click', ()=> {
  const res = computeAll();
  const adv = generateAdvice(res);
  const advEl = $('#adviceArea');
  advEl.innerHTML = adv.map(a=>`<div class="arg" style="margin-top:8px"><h4>${a.t}</h4><p>${a.d}</p></div>`).join('');
  updateUI(res);
  // show final overview step (keep on step 4)
});

/* reset */
$('#resetBtn').addEventListener('click', ()=>{
  localStorage.removeItem(STORAGE_KEY);
  location.reload();
});

/* export to PDF - basic print */
$('#exportBtn').addEventListener('click', ()=> window.print());

/* compute on load */
(function init(){
  const res = computeAll();
  updateUI(res);
})();

</script>
</body>
</html>